kind: AdaptiveDialog
beginDialog:
  kind: OnGeneratedResponse
  id: main
  condition: =CountRows(System.Response.Citations) > 0
  actions:
    - kind: SetVariable
      id: setVariable_wtNwaw
      variable: Topic.externalWebsiteURL
      value: https://yourwebsite.com/citations/

    - kind: SetVariable
      id: setVariable_9IFwdP
      variable: Topic.CitationsSnip
      value: |
        =With(
            { CitationsTable: System.Response.Citations },
            Concat(
                ForAll(
                    Sequence(CountRows(CitationsTable)) As seqItem,
                    With(
                        { currentRecord: Index(CitationsTable, seqItem.Value) },
                        "[" & Text(seqItem.Value) & "]: " &
                        If(
                            IsBlank(currentRecord.Url),
                            If(
                                Left(currentRecord.Name, 8) = "https://",
                                Substitute(currentRecord.Name, " ", "%20"),
                                Substitute(
                                    Topic.externalWebsiteURL & currentRecord.Name,
                                    " ",
                                    "%20"
                                ) &
                                If(
                                    EndsWith(currentRecord.Name, ".pdf") &&
                                    !IsBlank(currentRecord.Text) &&
                                    Find("<page value=", currentRecord.Text) > 0,
                                    "#page=" &
                                    Mid(
                                        currentRecord.Text,
                                        Find("<page value=", currentRecord.Text) + Len("<page value="),
                                        Find(">", currentRecord.Text) - Find("<page value=", currentRecord.Text) - Len("<page value=")
                                    ),
                                    ""
                                )
                            ),
                            currentRecord.Url
                        ) & " \""" &
                        With(
                            { nameParts: Split(currentRecord.Name, "/") },
                            Substitute(
                                If(
                                    Find("?", Last(nameParts).Value) > 0,
                                    Left(
                                        Last(nameParts).Value,
                                        Find("?", Last(nameParts).Value)
                                    ),
                                    Last(nameParts).Value
                                ),
                                "%20",
                                " "
                            )
                        ) & "\"""
                    )
                ),
                Char(13) & Char(10)
            )
        )

    - kind: SendActivity
      id: sendActivity_i4mW3G
      activity: =Left(System.Response.FormattedText, Find("[1]:", System.Response.FormattedText) - 1) & Text(Topic.CitationsSnip)

    - kind: SetVariable
      id: setVariable_jVzQGX
      variable: System.ContinueResponse
      value: false

inputType: {}
outputType: {}