kind: AdaptiveDialog
modelDescription: |-
  You will respond to requests about the education of the user making the request. This data is retrieved from Workday. You will respond to the user based on which piece of data they are asking for. This data exclusively belongs to the user making the request. There is no data for anyone else. Do not respond to questions about other people's data.
  
  Example invalid requests:
  "What is my manager's education?"
  "What is my sister's education?"
  
  Example valid requests:
  "What is my education?"
inputs:
  - kind: AutomaticTaskInput
    propertyName: EmployeeName
    description: The name of the person whose employment data is being requested.
    entity: PersonNamePrebuiltEntity
    shouldPromptUser: false

beginDialog:
  kind: OnRecognizedIntent
  id: main
  intent:
    triggerQueries:
      - Show my Education Details 
      - From which school I completed my BS degree Education? 
      - Show my Education Degrees 
      - What was my field of Study during Education? 
      - Show my First Year attended for BS degree Education? 
      - Show my Last Year attended for BS degree Education? 

  actions:
    - kind: BeginDialog
      id: zQU3vE
      displayName: Check access
      input:
        binding:
          EmployeeName: =Topic.EmployeeName

      dialog: msdyn_copilotforemployeeselfservice.topic.WorkdaySystemAccessCheck

    - kind: BeginDialog
      id: B7ae9T
      displayName: Redirect to Get CommonExecution
      input:
        binding:
          parameters: ="{""params"":[{""key"":""{Employee_ID}"",""value"":""" & Global.ESS_UserContext_Employee_Id & """},{""key"":""{As_Of_Effective_Date}"",""value"":"""& Text(Today(), "yyyy-MM-dd") &"""}]}"
          scenarioName: msdyn_HRWorkdayHCMEmployeeGetEducation

      dialog: msdyn_copilotforemployeeselfservice.topic.WorkdaySystemGetCommonExecution
      output:
        binding:
          errorResponse: Topic.errorResponse
          isSuccess: Topic.isSuccess
          workdayResponse: Topic.workdayResponse

    - kind: ParseValue
      id: yJ0sSR
      displayName: Parse Workday response
      variable: Topic.parsedWorkdayResponse
      valueType:
        kind: Record
        properties:
          EducationData:
            type:
              kind: Table
              properties:
                Education_Data:
                  type:
                    kind: Table
                    properties:
                      Country_Reference:
                        type:
                          kind: Record
                          properties:
                            @Descriptor: String
                            ID:
                              type:
                                kind: Table
                                properties:
                                  @type: String
                                  "#text": String

                      Date_Degree_Received: String
                      Degree_Completed_Reference:
                        type:
                          kind: Record
                          properties:
                            @Descriptor: String
                            ID:
                              type:
                                kind: Table
                                properties:
                                  @type: String
                                  "#text": String

                      Degree_Reference:
                        type:
                          kind: Record
                          properties:
                            @Descriptor: String
                            ID:
                              type:
                                kind: Table
                                properties:
                                  @type: String
                                  "#text": String

                      Education_ID: String
                      Field_Of_Study_Reference:
                        type:
                          kind: Record
                          properties:
                            @Descriptor: String
                            ID:
                              type:
                                kind: Table
                                properties:
                                  @type: String
                                  "#text": String

                      First_Year_Attended: String
                      Is_Highest_Level_of_Education: String
                      Last_Year_Attended: String
                      Location: String
                      School_Name: String
                      School_Reference:
                        type:
                          kind: Record
                          properties:
                            @Descriptor: String
                            ID:
                              type:
                                kind: Table
                                properties:
                                  @type: String
                                  "#text": String

                Education_Reference:
                  type:
                    kind: Record
                    properties:
                      @Descriptor: String
                      ID:
                        type:
                          kind: Table
                          properties:
                            @type: String
                            "#text": String

      value: =Topic.workdayResponse

    - kind: BeginDialog
      id: M8G7as
      displayName: Refresh country name reference data
      input:
        binding:
          IsTableEmpty: =IsBlank(Global.CountryNameLookupTable)
          ReferenceDataKey: ISO_3166-1_Alpha-2_Code

      dialog: msdyn_copilotforemployeeselfservice.topic.WorkdaySystemRefreshReferenceData

    - kind: BeginDialog
      id: iM5A5i
      displayName: Refresh degree reference data
      input:
        binding:
          IsTableEmpty: =IsBlank(Global.DegreeTypeLookupTable)
          ReferenceDataKey: Degree_ID

      dialog: msdyn_copilotforemployeeselfservice.topic.WorkdaySystemRefreshReferenceData

    - kind: BeginDialog
      id: zG3du7
      displayName: Refresh field of study reference data
      input:
        binding:
          IsTableEmpty: =IsBlank(Global.FieldOfStudyLookupTable)
          ReferenceDataKey: Field_Of_Study_ID

      dialog: msdyn_copilotforemployeeselfservice.topic.WorkdaySystemRefreshReferenceData

    - kind: SetVariable
      id: setVariable_nD5Gkb
      displayName: Set final result data
      variable: Topic.FinalizedEducationData
      value: |
        =ForAll(
            Topic.parsedWorkdayResponse.EducationData,
                ForAll(
                    ThisRecord.Education_Data,
                    With(
                        {currentRecord: ThisRecord},
                        {
                            EmployeeName: Global.ESS_UserContext_Employee_Firstname & " " & Global.ESS_UserContext_Employee_Lastname,
                            Country: LookUp(
                                Global.CountryNameLookupTable,
                                ID = LookUp(
                                    currentRecord.Country_Reference.ID,
                                    '@type' = First(Global.CountryNameLookupTable).Reference_ID_Type
                                ).'#text'
                            ).Referenced_Object_Descriptor,
                            School: currentRecord.School_Name,
                            Degree: LookUp(
                                Global.DegreeTypeLookupTable,
                                ID = LookUp(
                                    currentRecord.Degree_Reference.ID,
                                    '@type' = First(Global.DegreeTypeLookupTable).Reference_ID_Type
                                ).'#text'
                            ).Referenced_Object_Descriptor,
                            FieldOfStudy: LookUp(
                                Global.FieldOfStudyLookupTable,
                                ID = LookUp(
                                    currentRecord.Field_Of_Study_Reference.ID,
                                    '@type' = First(Global.FieldOfStudyLookupTable).Reference_ID_Type
                                ).'#text'
                            ).Referenced_Object_Descriptor,
                            FirstYearAttended: currentRecord.First_Year_Attended,
                            LastYearAttended: currentRecord.Last_Year_Attended
                        }
                )
            )
        )

inputType:
  properties:
    EmployeeName:
      displayName: EmployeeName
      description: The name of the person whose employment data is being requested.
      type: String

outputType:
  properties:
    FinalizedEducationData:
      displayName: FinalizedEducationData
      type:
        kind: Table
        properties:
          Value:
            type:
              kind: Table
              properties:
                Country: String
                Degree: String
                EmployeeName: String
                FieldOfStudy: String
                FirstYearAttended: String
                LastYearAttended: String
                School: String